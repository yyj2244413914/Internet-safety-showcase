<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SecureDataFlow 访问控制</title>
  <!-- 引入外部资源 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <!-- JsTree 插件 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.12/themes/default/style.min.css">
  <!-- jQuery (JsTree依赖) -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Tailwind 配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            success: '#52C41A',
            warning: '#FAAD14',
            danger: '#F53F3F',
            dark: '#1D2129',
            'dark-2': '#4E5969',
            'light-1': '#F2F3F5',
            'light-2': '#E5E6EB'
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>

  <!-- 自定义工具类 -->
  <style type="text/tailwindcss">
    @layer utilities {
      .role-admin { background-color: rgba(245, 63, 63, 0.1); color: #F53F3F; }
      .role-editor { background-color: rgba(22, 93, 255, 0.1); color: #165DFF; }
      .role-viewer { background-color: rgba(82, 196, 26, 0.1); color: #52C41A; }
      .role-auditor { background-color: rgba(250, 173, 20, 0.1); color: #FAAD14; }
      
      .jstree-default .jstree-anchor { 
        color: var(--dark);
        font-family: 'Inter', sans-serif;
      }
      .jstree-default .jstree-clicked {
        background: rgba(22, 93, 255, 0.1);
        box-shadow: none;
      }
      .jstree-default .jstree-hovered {
        background: rgba(22, 93, 255, 0.05);
      }
      
      /* 模态框样式 */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }
      .modal-content {
        background-color: white;
        padding: 2rem;
        border-radius: 0.5rem;
        width: 90%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
      }
      .modal-title {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
      }
      .modal-footer {
        display: flex;
        justify-content: flex-end;
        margin-top: 1.5rem;
        gap: 0.75rem;
      }
    }
  </style>
</head>

<body class="font-inter bg-gray-50 text-dark min-h-screen flex flex-col">
  <!-- 顶部导航栏 -->
  <header class="bg-white shadow-sm fixed w-full z-50 transition-all duration-300" id="header">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <!-- 左侧Logo和标题 -->
        <div class="flex items-center">
          <div class="flex-shrink-0 flex items-center">
            <div class="w-8 h-8 rounded-md gradient-bg flex items-center justify-center">
              <i class="fa fa-shield text-white"></i>
            </div>
            <span class="ml-2 text-lg font-semibold text-dark">SecureDataFlow 访问控制</span>
          </div>
        </div>

        <!-- 右侧工具栏 -->
        <div class="flex items-center space-x-4">
          <!-- 最后更新时间 -->
          <span class="text-sm text-dark-2 hidden sm:block" id="lastUpdate">最后更新: 刚刚</span>
          
          <!-- 刷新按钮 -->
          <button class="p-2 rounded-full hover:bg-light-1 transition-colors" id="refreshBtn">
            <i class="fa fa-refresh text-dark-2"></i>
          </button>

          <!-- 用户信息 -->
          <div class="flex items-center">
            <img class="h-8 w-8 rounded-full object-cover" src="https://randomuser.me/api/portraits/men/32.jpg" alt="用户头像">
            <span class="ml-2 text-sm font-medium hidden md:block">系统管理员</span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- 主内容区 -->
  <main class="flex-1 pt-20 pb-10">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <!-- 页面标题 -->
      <div class="mb-8">
        <h1 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-dark">用户与权限管理</h1>
        <p class="text-dark-2 mt-1">基于 RBAC 模型的集中式访问控制系统</p>
      </div>

      <!-- 三栏布局 -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- 左侧栏 - 用户列表和权限矩阵 -->
        <div class="lg:col-span-2 space-y-6">
          <!-- 用户列表 -->
          <div class="bg-white rounded-xl card-shadow overflow-hidden">
            <div class="border-b border-light-2 px-6 py-4 flex justify-between items-center">
              <h2 class="font-semibold text-lg">
                <i class="fa fa-users text-primary mr-2"></i>用户列表
              </h2>
              <div class="flex space-x-3">
                <button class="text-sm text-primary hover:text-opacity-80">
                  <i class="fa fa-filter mr-1"></i>筛选
                </button>
                <button class="text-sm text-primary hover:text-opacity-80" id="addUserBtn">
                  <i class="fa fa-plus mr-1"></i>添加用户
                </button>
              </div>
            </div>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-light-2">
                <thead>
                  <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-dark-2 uppercase tracking-wider">用户</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-dark-2 uppercase tracking-wider">所属单位</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-dark-2 uppercase tracking-wider">最后登录</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-dark-2 uppercase tracking-wider">角色</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-dark-2 uppercase tracking-wider">操作</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-light-2">
                  <!-- 用户行 1 -->
                  <tr class="hover:bg-light-1 transition">
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="flex items-center">
                        <img class="h-10 w-10 rounded-full object-cover" src="https://randomuser.me/api/portraits/men/32.jpg" alt="">
                        <div class="ml-4">
                          <div class="font-medium">张伟</div>
                          <div class="text-dark-2 text-sm">zhangwei@securedataflow.com</div>
                        </div>
                      </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-dark-2">数据安全部</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-dark-2">2025-07-25 14:30</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span class="px-3 py-1 rounded-full text-xs font-medium role-admin">管理员</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                      <button class="text-primary hover:text-opacity-80 mr-3 edit-user-btn" data-user-id="1">
                        <i class="fa fa-edit"></i>
                      </button>
                      <button class="text-danger hover:text-opacity-80 delete-user-btn" data-user-id="1">
                        <i class="fa fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                  
                  <!-- 用户行 2 -->
                  <tr class="hover:bg-light-1 transition">
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="flex items-center">
                        <img class="h-10 w-10 rounded-full object-cover" src="https://randomuser.me/api/portraits/women/44.jpg" alt="">
                        <div class="ml-4">
                          <div class="font-medium">李娜</div>
                          <div class="text-dark-2 text-sm">lina@securedataflow.com</div>
                        </div>
                      </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-dark-2">研发中心</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-dark-2">2025-07-25 09:15</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span class="px-3 py-1 rounded-full text-xs font-medium role-editor">编辑者</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                      <button class="text-primary hover:text-opacity-80 mr-3 edit-user-btn" data-user-id="2">
                        <i class="fa fa-edit"></i>
                      </button>
                      <button class="text-danger hover:text-opacity-80 delete-user-btn" data-user-id="2">
                        <i class="fa fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                  
                  <!-- 用户行 3 -->
                  <tr class="hover:bg-light-1 transition">
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="flex items-center">
                        <img class="h-10 w-10 rounded-full object-cover" src="https://randomuser.me/api/portraits/men/67.jpg" alt="">
                        <div class="ml-4">
                          <div class="font-medium">王强</div>
                          <div class="text-dark-2 text-sm">wangqiang@securedataflow.com</div>
                        </div>
                      </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-dark-2">市场部</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-dark-2">2025-07-24 16:45</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span class="px-3 py-1 rounded-full text-xs font-medium role-viewer">查看者</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                      <button class="text-primary hover:text-opacity-80 mr-3 edit-user-btn" data-user-id="3">
                        <i class="fa fa-edit"></i>
                      </button>
                      <button class="text-danger hover:text-opacity-80 delete-user-btn" data-user-id="3">
                        <i class="fa fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                  
                  <!-- 用户行 4 -->
                  <tr class="hover:bg-light-1 transition">
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="flex items-center">
                        <img class="h-10 w-10 rounded-full object-cover" src="https://randomuser.me/api/portraits/women/28.jpg" alt="">
                        <div class="ml-4">
                          <div class="font-medium">赵敏</div>
                          <div class="text-dark-2 text-sm">zhaomin@securedataflow.com</div>
                        </div>
                      </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-dark-2">审计合规部</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-dark-2">2025-07-25 11:20</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span class="px-3 py-1 rounded-full text-xs font-medium role-auditor">审计员</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                      <button class="text-primary hover:text-opacity-80 mr-3 edit-user-btn" data-user-id="4">
                        <i class="fa fa-edit"></i>
                      </button>
                      <button class="text-danger hover:text-opacity-80 delete-user-btn" data-user-id="4">
                        <i class="fa fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <!-- 分页 -->
            <div class="px-6 py-4 flex items-center justify-between border-t border-light-2">
              <div class="text-sm text-dark-2">
                显示 <span class="font-medium">1</span> 到 <span class="font-medium">4</span> 条，共 <span class="font-medium">4</span> 条
              </div>
              <div class="flex space-x-2">
                <button class="px-3 py-1 border border-light-2 rounded text-sm text-dark-2 hover:bg-light-1">
                  上一页
                </button>
                <button class="px-3 py-1 bg-primary text-white rounded text-sm hover:bg-opacity-90">
                  1
                </button>
                <button class="px-3 py-1 border border-light-2 rounded text-sm text-dark-2 hover:bg-light-1">
                  2
                </button>
                <button class="px-3 py-1 border border-light-2 rounded text-sm text-dark-2 hover:bg-light-1">
                  下一页
                </button>
              </div>
            </div>
          </div>

          <!-- 权限矩阵 -->
          <div class="bg-white rounded-xl card-shadow overflow-hidden">
            <div class="border-b border-light-2 px-6 py-4">
              <h2 class="font-semibold text-lg">
                <i class="fa fa-table text-primary mr-2"></i>权限矩阵
              </h2>
            </div>
            <div class="p-6 overflow-x-auto">
              <table class="min-w-full">
                <thead>
                  <tr>
                    <th class="px-6 py-3 text-left text-sm font-medium text-dark-2 uppercase">资源/操作</th>
                    <th class="px-6 py-3 text-left text-sm font-medium text-dark-2 uppercase">管理员</th>
                    <th class="px-6 py-3 text-left text-sm font-medium text-dark-2 uppercase">编辑者</th>
                    <th class="px-6 py-3 text-left text-sm font-medium text-dark-2 uppercase">查看者</th>
                    <th class="px-6 py-3 text-left text-sm font-medium text-dark-2 uppercase">审计员</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-light-2">
                  <tr class="hover:bg-light-1 transition">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">数据仪表板</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-success">完全控制</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-success">编辑</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-success">查看</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-success">查看</td>
                  </tr>
                  <tr class="hover:bg-light-1 transition">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">数据源管理</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-success">完全控制</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-success">编辑</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-danger">无权限</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-success">查看</td>
                  </tr>
                  <tr class="hover:bg-light-1 transition">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">隐私计算任务</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-success">完全控制</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-success">创建/执行</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-danger">无权限</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-warning">仅审计</td>
                  </tr>
                  <tr class="hover:bg-light-1 transition">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">用户管理</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-success">完全控制</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-danger">无权限</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-danger">无权限</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-success">查看</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- 右侧栏 - 角色与权限树 -->
        <div class="space-y-6">
          <!-- 角色管理 -->
          <div class="bg-white rounded-xl card-shadow overflow-hidden">
            <div class="border-b border-light-2 px-6 py-4">
              <h2 class="font-semibold text-lg">
                <i class="fa fa-id-card text-primary mr-2"></i>角色管理
              </h2>
            </div>
            <div class="p-6">
              <div class="space-y-4">
                <!-- 角色项 -->
                <div class="flex items-center justify-between p-3 hover:bg-light-1 rounded transition">
                  <div>
                    <div class="font-medium">管理员</div>
                    <div class="text-dark-2 text-sm mt-1">拥有系统所有权限</div>
                  </div>
                  <span class="text-xs px-2 py-1 rounded-full role-admin">4用户</span>
                </div>
                
                <div class="flex items-center justify-between p-3 hover:bg-light-1 rounded transition">
                  <div>
                    <div class="font-medium">编辑者</div>
                    <div class="text-dark-2 text-sm mt-1">可创建/编辑资源</div>
                  </div>
                  <span class="text-xs px-2 py-1 rounded-full role-editor">12用户</span>
                </div>
                
                <div class="flex items-center justify-between p-3 hover:bg-light-1 rounded transition">
                  <div>
                    <div class="font-medium">查看者</div>
                    <div class="text-dark-2 text-sm mt-1">仅查看权限</div>
                  </div>
                  <span class="text-xs px-2 py-1 rounded-full role-viewer">7用户</span>
                </div>
                
                <div class="flex items-center justify-between p-3 hover:bg-light-1 rounded transition">
                  <div>
                    <div class="font-medium">审计员</div>
                    <div class="text-dark-2 text-sm mt-1">查看日志与审计</div>
                  </div>
                  <span class="text-xs px-2 py-1 rounded-full role-auditor">3用户</span>
                </div>
              </div>
              
              <button class="w-full mt-4 text-primary text-sm font-medium hover:text-opacity-80 flex items-center justify-center" id="addRoleBtn">
                <i class="fa fa-plus mr-1"></i>新建角色
              </button>
            </div>
          </div>

          <!-- 权限树 -->
          <div class="bg-white rounded-xl card-shadow overflow-hidden">
            <div class="border-b border-light-2 px-6 py-4">
              <h2 class="font-semibold text-lg">
                <i class="fa fa-sitemap text-primary mr-2"></i>权限树
              </h2>
            </div>
            <div class="p-6">
              <div id="permission-tree" class="h-96 overflow-auto"></div>
              
              <div class="mt-4 flex justify-between">
                <button class="text-sm text-primary hover:text-opacity-80" id="refreshTreeBtn">
                  <i class="fa fa-refresh mr-1"></i>刷新
                </button>
                <button class="text-sm text-primary hover:text-opacity-80" id="saveTreeBtn">
                  <i class="fa fa-save mr-1"></i>保存配置
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- 页脚 -->
  <footer class="bg-white border-t border-light-2 py-6">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="text-dark-2 text-sm mb-4 md:mb-0">
          © 2025 SecureDataFlow. 保留所有权利.
        </div>
        <div class="flex space-x-6">
          <a href="#" class="text-dark-2 hover:text-primary text-sm">隐私政策</a>
          <a href="#" class="text-dark-2 hover:text-primary text-sm">服务条款</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- 模态框模板 -->
  <div id="userModal" class="modal">
    <div class="modal-content">
      <h3 class="modal-title" id="modalTitle">添加用户</h3>
      <form id="userForm">
        <input type="hidden" id="userId">
        <div class="space-y-4">
          <div>
            <label for="userName" class="block text-sm font-medium text-dark-2 mb-1">姓名</label>
            <input type="text" id="userName" class="w-full px-3 py-2 border border-light-2 rounded focus:outline-none focus:ring-1 focus:ring-primary">
          </div>
          <div>
            <label for="userEmail" class="block text-sm font-medium text-dark-2 mb-1">邮箱</label>
            <input type="email" id="userEmail" class="w-full px-3 py-2 border border-light-2 rounded focus:outline-none focus:ring-1 focus:ring-primary">
          </div>
          <div>
            <label for="userDepartment" class="block text-sm font-medium text-dark-2 mb-1">部门</label>
            <select id="userDepartment" class="w-full px-3 py-2 border border-light-2 rounded focus:outline-none focus:ring-1 focus:ring-primary">
              <option value="数据安全部">数据安全部</option>
              <option value="研发中心">研发中心</option>
              <option value="市场部">市场部</option>
              <option value="审计合规部">审计合规部</option>
            </select>
          </div>
          <div>
            <label for="userRole" class="block text-sm font-medium text-dark-2 mb-1">角色</label>
            <select id="userRole" class="w-full px-3 py-2 border border-light-2 rounded focus:outline-none focus:ring-1 focus:ring-primary">
              <option value="admin">管理员</option>
              <option value="editor">编辑者</option>
              <option value="viewer">查看者</option>
              <option value="auditor">审计员</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="px-4 py-2 border border-light-2 rounded text-dark-2 hover:bg-light-1" id="cancelUserBtn">取消</button>
          <button type="submit" class="px-4 py-2 bg-primary text-white rounded hover:bg-opacity-90">保存</button>
        </div>
      </form>
    </div>
  </div>

  <div id="roleModal" class="modal">
    <div class="modal-content">
      <h3 class="modal-title">新建角色</h3>
      <form id="roleForm">
        <div class="space-y-4">
          <div>
            <label for="roleName" class="block text-sm font-medium text-dark-2 mb-1">角色名称</label>
            <input type="text" id="roleName" class="w-full px-3 py-2 border border-light-2 rounded focus:outline-none focus:ring-1 focus:ring-primary">
          </div>
          <div>
            <label for="roleDescription" class="block text-sm font-medium text-dark-2 mb-1">角色描述</label>
            <textarea id="roleDescription" rows="3" class="w-full px-3 py-2 border border-light-2 rounded focus:outline-none focus:ring-1 focus:ring-primary"></textarea>
          </div>
          <div>
            <label class="block text-sm font-medium text-dark-2 mb-1">权限设置</label>
            <div class="border border-light-2 rounded p-3">
              <div id="rolePermissionTree"></div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="px-4 py-2 border border-light-2 rounded text-dark-2 hover:bg-light-1" id="cancelRoleBtn">取消</button>
          <button type="submit" class="px-4 py-2 bg-primary text-white rounded hover:bg-opacity-90">创建</button>
        </div>
      </form>
    </div>
  </div>

  <!-- JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.12/jstree.min.js"></script>
  <script>
    // 初始化权限树
    document.addEventListener('DOMContentLoaded', function() {
      // 主权限树
      $('#permission-tree').jstree({
        'core': {
          'data': [
            {
              "text": "组织架构",
              "state": { "opened": true },
              "children": [
                { "text": "数据安全部", "type": "department" },
                { "text": "研发中心", "type": "department" },
                { "text": "市场部", "type": "department" },
                { "text": "审计合规部", "type": "department" }
              ]
            },
            {
              "text": "数据资源",
              "state": { "opened": true },
              "children": [
                { 
                  "text": "敏感数据",
                  "children": [
                    { "text": "用户个人信息", "type": "database" },
                    { "text": "财务数据", "type": "database" }
                  ]
                },
                { 
                  "text": "普通数据",
                  "children": [
                    { "text": "产品目录", "type": "database" },
                    { "text": "市场分析", "type": "database" }
                  ]
                }
              ]
            },
            {
              "text": "操作权限",
              "state": { "opened": true },
              "children": [
                { "text": "读取", "type": "permission" },
                { "text": "创建", "type": "permission" },
                { "text": "编辑", "type": "permission" },
                { "text": "删除", "type": "permission" },
                { "text": "执行", "type": "permission" }
              ]
            }
          ],
          "themes": {
            "responsive": false,
            "dots": true
          }
        },
        "plugins": ["wholerow", "checkbox", "types"],
        "types": {
          "department": { "icon": "fa fa-users" },
          "database": { "icon": "fa fa-database" },
          "permission": { "icon": "fa fa-key" }
        }
      });

      // 角色权限树（用于角色创建模态框）
      $('#rolePermissionTree').jstree({
        'core': {
          'data': [
            {
              "text": "数据仪表板",
              "state": { "opened": true },
              "children": [
                { "text": "查看", "type": "permission" },
                { "text": "编辑", "type": "permission" },
                { "text": "删除", "type": "permission" }
              ]
            },
            {
              "text": "数据源管理",
              "state": { "opened": true },
              "children": [
                { "text": "查看", "type": "permission" },
                { "text": "创建", "type": "permission" },
                { "text": "编辑", "type": "permission" },
                { "text": "删除", "type": "permission" }
              ]
            },
            {
              "text": "用户管理",
              "state": { "opened": true },
              "children": [
                { "text": "查看", "type": "permission" },
                { "text": "创建", "type": "permission" },
                { "text": "编辑", "type": "permission" },
                { "text": "删除", "type": "permission" }
              ]
            }
          ],
          "themes": {
            "responsive": false,
            "dots": true
          }
        },
        "plugins": ["wholerow", "checkbox", "types"],
        "types": {
          "permission": { "icon": "fa fa-key" }
        }
      });

      // 模态框操作
      const userModal = document.getElementById('userModal');
      const roleModal = document.getElementById('roleModal');
      const modalTitle = document.getElementById('modalTitle');
      const userForm = document.getElementById('userForm');
      const roleForm = document.getElementById('roleForm');

      // 显示模态框
      function showModal(modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
      }

      // 隐藏模态框
      function hideModal(modal) {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
      }

      // 添加用户按钮事件
      document.getElementById('addUserBtn').addEventListener('click', function() {
        modalTitle.textContent = '添加用户';
        userForm.reset();
        document.getElementById('userId').value = '';
        showModal(userModal);
      });

      // 编辑用户按钮事件
      document.querySelectorAll('.edit-user-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const userId = this.getAttribute('data-user-id');
          // 这里应该是从API获取用户数据，这里用模拟数据
          const userData = {
            '1': { name: '张伟', email: 'zhangwei@securedataflow.com', department: '数据安全部', role: 'admin' },
            '2': { name: '李娜', email: 'lina@securedataflow.com', department: '研发中心', role: 'editor' },
            '3': { name: '王强', email: 'wangqiang@securedataflow.com', department: '市场部', role: 'viewer' },
            '4': { name: '赵敏', email: 'zhaomin@securedataflow.com', department: '审计合规部', role: 'auditor' }
          };
          
          const user = userData[userId];
          if (user) {
            modalTitle.textContent = '编辑用户';
            document.getElementById('userId').value = userId;
            document.getElementById('userName').value = user.name;
            document.getElementById('userEmail').value = user.email;
            document.getElementById('userDepartment').value = user.department;
            document.getElementById('userRole').value = user.role;
            showModal(userModal);
          }
        });
      });

      // 删除用户按钮事件
      document.querySelectorAll('.delete-user-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const userId = this.getAttribute('data-user-id');
          if (confirm('确定要删除这个用户吗？此操作无法撤销。')) {
            alert(`用户ID ${userId} 删除成功（模拟操作）`);
            // 实际项目中应该调用API删除用户
          }
        });
      });

      // 新建角色按钮事件
      document.getElementById('addRoleBtn').addEventListener('click', function() {
        showModal(roleModal);
      });

      // 保存用户表单
      userForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const userId = document.getElementById('userId').value;
        const userName = document.getElementById('userName').value;
        const userEmail = document.getElementById('userEmail').value;
        const userDepartment = document.getElementById('userDepartment').value;
        const userRole = document.getElementById('userRole').value;
        
        if (userId) {
          alert(`用户 ${userName} 更新成功（模拟操作）`);
        } else {
          alert(`用户 ${userName} 添加成功（模拟操作）`);
        }
        hideModal(userModal);
      });

      // 保存角色表单
      roleForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const roleName = document.getElementById('roleName').value;
        const roleDescription = document.getElementById('roleDescription').value;
        const selectedPermissions = $('#rolePermissionTree').jstree('get_selected');
        
        alert(`角色 ${roleName} 创建成功，选择了 ${selectedPermissions.length} 个权限（模拟操作）`);
        hideModal(roleModal);
      });

      // 取消按钮事件
      document.getElementById('cancelUserBtn').addEventListener('click', function() {
        hideModal(userModal);
      });
      
      document.getElementById('cancelRoleBtn').addEventListener('click', function() {
        hideModal(roleModal);
      });

      // 点击模态框外部关闭
      [userModal, roleModal].forEach(modal => {
        modal.addEventListener('click', function(e) {
          if (e.target === modal) {
            hideModal(modal);
          }
        });
      });

      // 刷新按钮功能
      const refreshBtn = document.getElementById('refreshBtn');
      if (refreshBtn) {
        refreshBtn.addEventListener('click', function() {
          const icon = refreshBtn.querySelector('i');
          icon.classList.add('fa-spin');

          setTimeout(() => {
            icon.classList.remove('fa-spin');
            document.getElementById('lastUpdate').textContent = '最后更新: ' + new Date().toLocaleTimeString();
            // 实际项目中应重新获取数据
          }, 800);
        });
      }

      // 刷新权限树
      document.getElementById('refreshTreeBtn').addEventListener('click', function() {
        $('#permission-tree').jstree('refresh');
        alert('权限树已刷新');
      });

      // 保存权限树配置
      document.getElementById('saveTreeBtn').addEventListener('click', function() {
        const selectedNodes = $('#permission-tree').jstree('get_selected');
        alert(`已保存权限配置，选择了 ${selectedNodes.length} 个节点（模拟操作）`);
      });
    });
  </script>

</body>

</html>