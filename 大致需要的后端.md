# dashboard大致需要的后端API

本文档详细列出了项目中需要与后端交互的所有 API 接口信息，包括接口端点、用途及代码位置等。


## 1. 仪表盘统计数据 API

### 基本信息
- **API 端点**: `/api/dashboard/stats`
- **用途**: 获取仪表盘概览统计数据（如任务总数、活跃节点数等）

### 代码位置
```javascript
// 加载仪表盘数据
async function loadDashboardData() {
  try {
    document.getElementById('lastUpdate').textContent = '加载中...';

    // 添加：设置1秒超时计时器
    window.dataLoadTimeout = setTimeout(() => {
      console.log('数据加载超时，重置为0');
      resetDataToZero();
      showNotification('数据加载超时，已显示默认值', 'warning');
    }, 1000); // 1秒超时

    await new Promise(resolve => setTimeout(resolve, 1000));

    // ====== API调用预留位置 ======
    // 实际项目中应调用API加载真实数据
    // const statsData = await fetch('/api/dashboard/stats').then(res => res.json());
    // updateOverviewStats(statsData);
    
    // 添加：如果成功获取数据，清除超时计时器
    if (window.dataLoadTimeout) {
      clearTimeout(window.dataLoadTimeout);
      window.dataLoadTimeout = null;
    }
```

### 说明
- 包含 1 秒超时机制，超时后会重置数据为 0 并显示警告通知
- 成功获取数据后会自动清除超时计时器


## 2. 图表数据 API

### 基本信息
- **API 端点**: `/api/dashboard/charts`
- **用途**: 获取所有图表的详细数据（如任务趋势、节点数据、流量统计、延迟数据等）

### 代码位置
```javascript
// 初始化图表框架（无数据）
function initChartFrames() {
  // 初始化空图表框架
  const charts = ['tasksChart', 'nodesChart', 'trafficChart', 'latencyChart'];
  charts.forEach(chartId => {
    // 修复：保存图表实例到window对象
    window[chartId + 'Instance'] = new Chart(document.getElementById(chartId), {
      type: 'line',
      data: {
        labels: Array(10).fill(''),
        datasets: [{
          data: Array(10).fill(null),
          borderColor: '#165DFF',
          backgroundColor: 'rgba(22, 93, 255, 0.1)',
          borderWidth: 2,
          pointRadius: 0,
          tension: 0.4,
          fill: true
        }]
      },
      options: getSmallChartOptions()
    });
  });

  // ====== API调用预留位置 ======
  // 实际项目中应调用API加载图表数据
  // fetch('/api/dashboard/charts')
  //   .then(res => res.json())
  //   .then(data => updateChartsWithData(data));
}
```


## 3. 用户头像图片 API

### 基本信息
- **API 说明**: 需要将模板中的 `{{userAvatarUrl}}` 替换为实际用户头像的 API 地址
- **用途**: 获取当前登录用户的头像图片

### 代码位置
```html
<!-- 用户信息 -->
<div class="flex items-center" id="userMenuContainer">
  <!-- 需要从后端数据库调取用户头像 -->
  <img class="h-8 w-8 rounded-full object-cover" src="{{userAvatarUrl}}" alt="用户头像">
  <span class="ml-2 text-sm font-medium hidden md:block">管理员 第136行 此行代码上一行是头像图片路径（记得改</span>
```

### 说明
- 头像图片路径位于代码第 136 行的上一行
- 需通过 API 动态获取当前登录用户的头像地址


## 4. 通知中心 API

### 基本信息
- **API 需求**: 需要实现通知列表获取接口
- **用途**: 获取用户通知消息列表

### 代码位置
```html
<!-- 通知下拉面板 (默认隐藏) -->
<div class="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg border border-light-2 hidden z-50"
  id="notificationDropdown">
  <div class="p-3 border-b border-light-2">
    <h3 class="font-medium text-dark">通知中心</h3>
  </div>
  <div class="p-3 text-center text-dark-2 text-sm">
    通知功能待完善，点击下方链接跳转至示例页面
  </div>
  <div class="p-2 border-t border-light-2">
    <a href="nothing.html"
      class="block text-center text-primary text-sm hover:bg-light-1 py-1 rounded">查看全部通知</a>
  </div>
</div>
```


## 5. 任务列表 API

### 基本信息
- **API 需求**: 需要实现任务列表数据获取接口
- **用途**: 获取最近任务列表数据

### 代码位置
```html
<!-- 最近任务列表 -->
<div class="bg-white rounded-xl p-6 card-shadow">
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-lg font-semibold text-dark">最近任务</h2>
    <a href="nothing.html" class="text-primary text-sm hover:underline" title="跳转至任务列表页面">查看全部</a>
  </div>

  <div class="space-y-5" id="recentTasks">
    <!-- 加载状态 -->
    <div class="flex flex-col items-center justify-center py-10 text-dark-2">
      <i class="fa fa-circle-o-notch fa-spin text-2xl mb-3"></i>
      <p>加载任务数据中...</p>
    </div>
  </div>
</div>
```


## 6. 告警信息 API

### 基本信息
- **API 需求**: 需要实现告警信息获取和清除接口
- **用途**: 获取安全告警数据及执行清除操作

### 代码位置
```html
<!-- 安全告警信息区 -->
<section>
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-lg font-semibold text-dark">安全告警信息</h2>
    <div class="flex items-center">
      <span class="text-sm text-dark-2 mr-2">共 <span class="text-danger font-medium" id="alertCount">0</span>
        条告警</span>
      <button class="text-primary text-sm hover:underline">清除全部</button>
    </div>
  </div>
</section>
```


## 集成说明
所有需要接入后端 API 的位置已在代码中通过 `// ====== API调用预留位置 ======` 注释明确标出，主要涉及以下六个模块：
- 仪表盘统计数据
- 图表数据
- 用户信息（头像）
- 通知中心
- 任务列表
- 告警信息

实际开发中，只需取消对应注释并替换为真实 API 端点即可完成集成。
