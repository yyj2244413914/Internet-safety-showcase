# 数据管理模块（Data Management）后端

描述数据管理前端模块所需的后端接口信息，包括接口定义、调用场景、参数说明及数据格式要求，供前后端开发对接使用。


## 1. 获取Hive数据表结构（核心数据）

### 接口信息
- **请求方式**: GET
- **接口地址**: `${API_BASE_URL}/hive/tables`
- **依赖变量**: 需全局定义 `API_BASE_URL`（前端代码第286行）


### 调用场景
- 函数调用位置：`window.fetchHiveTables`（前端代码第678-681行）
- 触发时机：
  - 模块初始化时，在 `initDataManagementModule` 中调用（第642行：`const tables = await fetchHiveTables();`）
  - 点击头部刷新按钮或内容区刷新按钮时（第708-724行）


### 请求参数
无额外参数，仅需基础URL。


### 返回数据用途
1. 构建左侧树状结构（数据库与表的层级关系），通过 `renderTree` 函数渲染（第377-436行）
2. 为审计日志的“表筛选器”提供选项（`initTableFilter` 函数，第648-676行），用于筛选特定表的审计记录


### 数据格式要求
```javascript
[
  {
    "id": "db1",  // 数据库唯一标识
    "type": "database",  // 节点类型（固定为database）
    "name": "数据库1",  // 数据库名称
    "children": [  // 包含的表列表（子节点）
      {
        "id": "tbl1",  // 表唯一标识
        "type": "table",  // 节点类型（固定为table）
        "name": "表1",  // 表名称
        "description": "表1描述"  // 表描述（可选字段）
      }
      // 更多表...
    ]
  }
  // 更多数据库...
]
```


## 2. 获取数据表权限矩阵

### 接口信息
- **请求方式**: GET
- **接口地址**: `${API_BASE_URL}/permissions/matrix?tableId=${tableId}`
- **依赖变量**: 需全局定义 `API_BASE_URL`


### 调用场景
- 函数调用位置：`window.fetchPermissionMatrix`（前端代码第683-686行）
- 触发时机：点击左侧表节点时（第431行：`loadPermissionMatrix(item.id, item.name)`）


### 请求参数
- `tableId`: 选中表的唯一标识（从树状结构数据的表节点`id`中获取）


### 返回数据用途
渲染“权限矩阵管理”标签页的表格内容（`loadPermissionMatrix` 函数，第440-467行），展示各部门对该表的“查看/编辑/导出/管理”权限状态。


### 数据格式要求
```javascript
[
  {
    "department": "部门A",  // 部门名称
    "view": true,    // 查看权限（true=有权限，false=无权限）
    "edit": false,   // 编辑权限
    "export": true,  // 导出权限
    "manage": false  // 管理权限
  }
  // 更多部门...
]
```


## 3. 获取数据调取审计日志

### 接口信息
- **请求方式**: GET
- **接口地址**: `${API_BASE_URL}/audit/logs?${queryParams}`
- **依赖变量**: 需全局定义 `API_BASE_URL`


### 调用场景
- 函数调用位置：`window.fetchAuditLogs`（前端代码第688-698行）
- 触发时机：
  - 模块初始化时（第646行：`await fetchAuditLogs(currentPage, pageSize);`）
  - 标签页切换到“数据调取审计”时（第336行）
  - 筛选器（表/用户）变化时（第368-371行）
  - 分页按钮（上一页/下一页）点击时（第353-361行）


### 请求参数
| 参数名 | 类型 | 说明 |
|--------|------|------|
| page | 数字 | 当前页码（默认1） |
| pageSize | 数字 | 每页条数（固定为10） |
| table | 字符串 | 表ID筛选（可选，来自表筛选器） |
| user | 字符串 | 用户筛选（可选，来自用户筛选器） |


### 返回数据用途
1. 渲染“数据调取审计”标签页的表格内容（`renderAuditLogs` 函数，第470-490行）
2. 更新分页状态（总条数、上/下一页按钮禁用状态，`updatePaginationControls` 函数，第700-706行）


### 数据格式要求
```javascript
{
  "total": 100,  // 总记录数（用于分页计算）
  "items": [
    {
      "user": "用户A",  // 操作人
      "tableName": "数据库1.表1",  // 操作的表（含数据库前缀）
      "action": "view",  // 操作类型：view（查看）/edit（编辑）/export（导出）/delete（删除）
      "timestamp": 1620000000000,  // 操作时间戳（毫秒级）
      "ipAddress": "192.168.1.1"  // 操作IP地址
    }
    // 更多日志记录...
  ]
}
```


## 通用说明
1. **请求实现**: 所有接口均通过 `fetch` 实现HTTP请求，依赖全局变量 `API_BASE_URL`（前端代码第286行）。
2. **数据格式**: 后端返回数据需为JSON格式，前端通过异步函数处理并渲染到对应UI区域。
3. **错误处理**: 前端已实现错误处理逻辑，请求失败时会显示友好提示（如“权限矩阵加载失败”“表结构加载失败”等）。
4. **实时性**: 后端数据请求与用户操作（点击、筛选、分页）强关联，确保数据实时性。
